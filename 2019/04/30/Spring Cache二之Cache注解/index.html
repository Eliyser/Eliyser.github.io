<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    
    <title>Spring Cache二之Cache注解 | never belief any book | love youself,love life</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#F98A8A">
    
    
    <meta name="keywords" content="">
    <meta name="description" content="Cache注解 开启注解，以后再方法上加个注解就可以自动把查询到的数据放到缓存中。 如果是用xml配置文件创建CacheManager的话，添加以下配置即开启cache注解： &amp;lt;!--假设上面注册了spring的CacheManager，id为cacheManager--&amp;gt; &amp;lt;cache:annotation-driven cache-manager=&amp;quot;cacheMan">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring Cache二之Cache注解">
<meta property="og:url" content="http://47.107.237.149/2019/04/30/Spring Cache二之Cache注解/index.html">
<meta property="og:site_name" content="never belief any book">
<meta property="og:description" content="Cache注解 开启注解，以后再方法上加个注解就可以自动把查询到的数据放到缓存中。 如果是用xml配置文件创建CacheManager的话，添加以下配置即开启cache注解： &amp;lt;!--假设上面注册了spring的CacheManager，id为cacheManager--&amp;gt; &amp;lt;cache:annotation-driven cache-manager=&amp;quot;cacheMan">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://zhuzhuzai.oss-cn-shenzhen.aliyuncs.com/%E6%8D%95%E8%8E%B7683.PNG">
<meta property="og:image" content="http://zhuzhuzai.oss-cn-shenzhen.aliyuncs.com/%E6%8D%95%E8%8E%B7684.PNG">
<meta property="og:updated_time" content="2019-05-03T09:08:17.994Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Spring Cache二之Cache注解">
<meta name="twitter:description" content="Cache注解 开启注解，以后再方法上加个注解就可以自动把查询到的数据放到缓存中。 如果是用xml配置文件创建CacheManager的话，添加以下配置即开启cache注解： &amp;lt;!--假设上面注册了spring的CacheManager，id为cacheManager--&amp;gt; &amp;lt;cache:annotation-driven cache-manager=&amp;quot;cacheMan">
<meta name="twitter:image" content="http://zhuzhuzai.oss-cn-shenzhen.aliyuncs.com/%E6%8D%95%E8%8E%B7683.PNG">
    
        <link rel="alternate" type="application/atom+xml" title="never belief any book" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/logo.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Haien</h5>
          <a href="mailto:1410343862@qq.com" title="1410343862@qq.com" class="mail">1410343862@qq.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/Eliyser" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                Weibo
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/custom"  >
                <i class="icon icon-lg icon-link"></i>
                测试
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">Spring Cache二之Cache注解</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">Spring Cache二之Cache注解</h1>
        <h5 class="subtitle">
            
                <time datetime="2019-04-30T08:25:45.760Z" itemprop="datePublished" class="page-time">
  2019-04-30
</time>


            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Cache注解"><span class="post-toc-number">1.</span> <span class="post-toc-text">Cache注解</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#注解参数所用的SpEL"><span class="post-toc-number">2.</span> <span class="post-toc-text">注解参数所用的SpEL</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#条件缓存"><span class="post-toc-number">3.</span> <span class="post-toc-text">条件缓存</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Caching"><span class="post-toc-number">4.</span> <span class="post-toc-text">@Caching</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#运行流程"><span class="post-toc-number">5.</span> <span class="post-toc-text">运行流程</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#解决-Cacheable和-CachePut不能同时用的问题"><span class="post-toc-number">5.1.</span> <span class="post-toc-text">解决@Cacheable和@CachePut不能同时用的问题</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#自定义组合注解"><span class="post-toc-number">5.2.</span> <span class="post-toc-text">自定义组合注解</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#KeyGenerator"><span class="post-toc-number">6.</span> <span class="post-toc-text">KeyGenerator</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#使用xml代替缓存注解"><span class="post-toc-number">7.</span> <span class="post-toc-text">使用xml代替缓存注解</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#缓存模糊匹配"><span class="post-toc-number">8.</span> <span class="post-toc-text">缓存模糊匹配</span></a></li></ol>
        </nav>
    </aside>


<article id="post-Spring Cache二之Cache注解"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">Spring Cache二之Cache注解</h1>
        <div class="post-meta">
            <time class="post-time" title="2019-04-30 16:25:45" datetime="2019-04-30T08:25:45.760Z"  itemprop="datePublished">2019-04-30</time>

            


            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h3 id="Cache注解"><a href="#Cache注解" class="headerlink" title="Cache注解"></a>Cache注解</h3><ul>
<li>开启注解，以后再方法上加个注解就可以自动把查询到的数据放到缓存中。</li>
<li><p>如果是用xml配置文件创建CacheManager的话，添加以下配置即开启cache注解：</p>
<pre><code>&lt;!--假设上面注册了spring的CacheManager，id为cacheManager--&gt;
&lt;cache:annotation-driven cache-manager=&quot;cacheManager&quot; proxy-target-class=&quot;true&quot;/&gt;
&lt;!--还有一个属性key-generator，即key生成策略，默认是SimpleKeyGenerator--&gt;
</code></pre></li>
<li><p>如果是Java configuration的话：</p>
</li>
</ul>
<pre><code>@Configuration
@ComponentScan(basePackages = &quot;com.haien.sping.cache.service&quot;)
@EnableCaching(proxyTargetClass = true) //效果同&lt;cache:annotation-driven/&gt;，开启注解
public class AnnotationCacheConfig {
    @Bean
    public CacheManager cacheManager(){
        try {
            //2.
            net.sf.ehcache.CacheManager ehcacheCacheManager=new net.sf.ehcache.CacheManager(
                    new ClassPathResource(&quot;ehcache.xml&quot;).getInputStream()); //1.
            //3.
            EhCacheCacheManager cacheCacheManager=new EhCacheCacheManager(ehcacheCacheManager);

            return cacheCacheManager;
        } catch (IOException e) { //getInputStream()抛出的
            throw new RuntimeException(e);
        }
    }
}
</code></pre><ul>
<li>如果想要设置KeyGenerator的话，可以实现CachingConfigurer：</li>
</ul>
<pre><code>@Configuration
@ComponentScan(basePackages = &quot;com.haien.sping.cache.service&quot;)
@EnableCaching(proxyTargetClass = true)
public class AnnotCacheConfWithKeyGenertor implements CachingConfigurer {
    @Bean
    public CacheManager cacheManager() {
        try {
            net.sf.ehcache.CacheManager ehcacheCacheManager=new net.sf.ehcache.CacheManager(
                    new ClassPathResource(&quot;ehcache.xml&quot;).getInputStream()
            );
            EhCacheCacheManager cacheCacheManager=new EhCacheCacheManager(ehcacheCacheManager);

            return cacheCacheManager;
        } catch (IOException e) {
            throw new RuntimeException(e);
        }
    }

    //默认为此
    @Bean
    public KeyGenerator keyGenerator() {
        return new SimpleKeyGenerator();
    }
}
</code></pre><ul>
<li>然后使用cache注解：所有注解都可以放在类或方法上，如果放在类上则会应用到所有方法上；并且，如果将注解放在接口类的方法上，则所有实现类在重写方法时都会继承这个注解。</li>
</ul>
<pre><code>@Service
public class UserService {
    //假设这是数据库
    Set&lt;User&gt; users=new HashSet&lt;User&gt;();

    //调用该方法时，会把user.id作为key，放入value指定的缓存，可以指定多个缓存，
      如,value={&quot;user1&quot;,&quot;user2&quot;}；#表示调用参数
    @CachePut(value = &quot;user&quot;,key = &quot;#user.id&quot;) 
    public User save(User user){
        users.add(user);
        return user;
    }

    //调用方法前先从缓存中读取，没有再调用方法并把数据放进缓存
    @Cacheable(value = &quot;user&quot;,key=&quot;#id&quot;) 
    public User findById(final Long id){
        System.out.println(&quot;cache miss,invoke find by id,id=&quot;+id);
        for(User user:users){
            if(user.getId().equals(id))
                return user;
        }

        return null;
    }

    @CacheEvict(value = &quot;user&quot;,key = &quot;#user.id&quot;) //移除指定key的数据
    public void delete(User user){
        users.remove(user);
    }

    @CacheEvict(value = &quot;user&quot;,allEntries = true) //移除所有数据
    public void deleteAll(){
        users.clear();
    }
}
</code></pre><ul>
<li>@CachePut：应用在写数据的方法上，在调用方法前并不会先检查缓存中是否已有该值，即有也会被覆盖。</li>
</ul>
<pre><code>public @interface CachePut {
    String[] value(); //缓存的名字，可以把数据放入多个缓存；支持SpEL表达式

    String key() default &quot;&quot;; //缓存key，不指定将使用默认的KeyGenerator生成；SpEL

    String condition() default &quot;&quot;; //能否放入缓存的条件，在方法调用前后都会判断；
                                     SpEL

    String unless() default &quot;&quot;; //返回false则能放入缓存；SpEL
}
</code></pre><ul>
<li>@Cacheable: 应用在读数据的方法上，即可缓存的方法上，如查找；调用前会先从缓存读取，没有再调用方法，并把数据放入缓存。</li>
</ul>
<pre><code>public @interface Cacheable {
    String[] value(); //同@CachePut
    String key() default &quot;&quot;; //同@CachePut
    String condition() default &quot;&quot;; //方法调用前判断是否能从缓存拿；
                                     执行方法后是否能把数据放入缓存的条件
    String unless() default &quot;&quot;; //返回false则能放入缓存
}
</code></pre><ul>
<li>@CacheEvict：应用在移除数据的方法上。</li>
</ul>
<pre><code>public @interface CacheEvict {
    String[] value(); //同@CachePut

    String key() default &quot;&quot;; //同@CachePut

    String condition() default &quot;&quot;; //调用前还是调用后判断取决于beforeInvocation

    boolean allEntries() default false; //是否移除所有数据

    boolean beforeInvocation() default false;//是调用方法前还是调用后移除
}
</code></pre><h3 id="注解参数所用的SpEL"><a href="#注解参数所用的SpEL" class="headerlink" title="注解参数所用的SpEL"></a>注解参数所用的SpEL</h3><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://zhuzhuzai.oss-cn-shenzhen.aliyuncs.com/%E6%8D%95%E8%8E%B7683.PNG" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<ul>
<li><p>target：被注解方法所在的类</p>
</li>
<li><p>通过这些数据我们可以实现比较复杂的缓存逻辑了。</p>
</li>
</ul>
<h3 id="条件缓存"><a href="#条件缓存" class="headerlink" title="条件缓存"></a>条件缓存</h3><ul>
<li>利用注解的condition或unless属性，进行有条件的缓存。</li>
<li>@Cacheable：在方法调用前判断condition，返回true则先从缓存中拿：</li>
</ul>
<pre><code>@Cacheable(value = &quot;user&quot;, key = &quot;#id&quot;, condition = &quot;#id lt 10&quot;) //id&lt;10？
public User conditionFindById(final Long id)

//condition示例：以下代码位于UserService类中
//判断执行前是否要先删缓存
@CacheEvict(value = &quot;user&quot;,key = &quot;#user.id&quot;,
    condition = &quot;#root.target.canEvict(#root.caches[0],#user.id,#user.username)&quot;,
    beforeInvocation = true)
public void conditionalUpdate(User user){
    users.remove(user);
    users.add(user);
}

/**
 * @Author haien
 * @Description 判断是否需要删除缓存
 * @Date 2019/3/24
 * @Param [userCache名为“user”的cache, id, username]
 * @return boolean
 **/
public boolean canEvict(Cache userCache,Long id,String username) {
    //根据id查出条目
    User user=userCache.get(id,User.class);
    //查不到则不用删缓存
    if(user==null)
        return false;

    //查到了但username不是指定的那个也不用删除
    return !user.getUsername().equals(username);
}
</code></pre><ul>
<li>以上方法缺点在于需要将缓存判断方法也暴露出去，而且缓存代码和业务代码混在一起，所以把canEvict()移到一个Helper静态类中更好(不过代码中没实现）：</li>
</ul>
<pre><code>@CacheEvict(value = &quot;user&quot;, key = &quot;#user.id&quot;, 
    condition = &quot;T(com.haien.service.UserCacheHelper)
        .canEvict(#root.caches[0], #user.id, #user.username)&quot;, 
    beforeInvocation = true)
public void conditionUpdate(User user){}
</code></pre><ul>
<li>@CachePut：以下condition需要result值，所以只在方法执行后才判断，返回true则放入缓存：</li>
</ul>
<pre><code>//ne：应该是not equal的意思
@CachePut(value = &quot;user&quot;, key = &quot;#id&quot;, condition = &quot;#result.username ne &apos;zhang&apos;&quot;)
public User conditionSave(final User user) 
</code></pre><ul>
<li>如下注解只在方法执行后才判断unless，返回false才放入缓存：</li>
</ul>
<pre><code>@CachePut(value = &quot;user&quot;, key = &quot;#user.id&quot;, 
    unless = &quot;#result.username eq &apos;zhang&apos;&quot;)
public User conditionSave2(final User user) 

//message是result的属性，contains是SpEL的方法
@Cacheable(value = &quot;spittleCache&quot;, 
    unless = &quot;#result.message.contains(&apos;NoCache&apos;)&quot;) 
Spittle findOne(long id);
</code></pre><ul>
<li>@CacheEvict：beforeInvocation=false表示在方法执行后才删除缓存，且condition要返回true才删除：</li>
</ul>
<pre><code>@CacheEvict(value = &quot;user&quot;, key = &quot;#user.id&quot;, beforeInvocation = false, 
    condition = &quot;#result.username ne &apos;zhang&apos;&quot;)
public User conditionDelete(final User user) 
</code></pre><h3 id="Caching"><a href="#Caching" class="headerlink" title="@Caching"></a>@Caching</h3><ul>
<li>用于组合多个注解使用。</li>
</ul>
<pre><code>public @interface Caching {
    Cacheable[] cacheable() default {}; //声明多个@Cacheable
    CachePut[] put() default {}; //声明多个@CachePut
    CacheEvict[] evict() default {}; //声明多个@CacheEvict
}
</code></pre><ul>
<li>比如，新增用户成功后，我们要分别以id、username和email为key同时存储value都为user实例的三条数据，这时可以使用该注解：</li>
</ul>
<pre><code>@Caching(
    put = {
            @CachePut(value = &quot;user&quot;, key = &quot;#user.id&quot;),
            @CachePut(value = &quot;user&quot;, key = &quot;#user.username&quot;),
            @CachePut(value = &quot;user&quot;, key = &quot;#user.email&quot;)
    }
)
public User save(User user) {}
</code></pre><ul>
<li>其实最好是id-user，然后username-id、email-id，保证user只存一份。</li>
</ul>
<h3 id="运行流程"><a href="#运行流程" class="headerlink" title="运行流程"></a>运行流程</h3><ul>
<li>使用@Caching组合多个注解或在同个方法加多个注解时，运行流程如下：</li>
</ul>
<ol>
<li>首先执行@CacheEvict清空缓存（如果beforeInvocation=true且condition通过）。</li>
<li>接着收集@Cacheable（如果condition通过，即方法执行后允许写入缓存，且key对应的数据不在缓存）；</li>
<li>然后收集@CachePut（如果condition通过）。</li>
<li>全部收集到cachePutRequests（表示缓存中缺失数据，有放入缓存的需求）。</li>
<li>如果cachePutRequests为空，那么@Cacheable时将先查找缓存，否则直接开始执行方法。</li>
<li>如果缓存中找不到数据，那么开始执行方法，把结果放入result。</li>
<li>执行cachePutRequests，把result中的数据写入缓存（如果unless返回false）。</li>
<li>执行@CacheEvict（如果beforeInvocation=false 且 condition 通过）。</li>
</ol>
<ul>
<li>其实也就是有beforeInvocation或condition这种需要在方法执行前先检查的注解先被处理，然后再执行方法，最后再处理有beforeInvocation或condition的注解。</li>
<li>由以上2、3步，只要注解中有@CachePut，cachePutRequests就不可能为空，@Cacheable就不会去缓存中取。</li>
</ul>
<h4 id="解决-Cacheable和-CachePut不能同时用的问题"><a href="#解决-Cacheable和-CachePut不能同时用的问题" class="headerlink" title="解决@Cacheable和@CachePut不能同时用的问题"></a>解决@Cacheable和@CachePut不能同时用的问题</h4><ul>
<li>只要有@CachePut在，@Cacheable就不会从缓存拿的问题其实只要改掉spring中CacheAspectSupport类某个方法的判断条件即可。</li>
<li>我们在自己的test包下建包：org.springframework.cache.intercepter(CacheAspectSupport原本就在spring框架中的该包下)，自己一模一样的CacheAspectSupport类，只修改其中判断能否从缓存查东西的条件（本来是只要有@CachePut就不查，现在改成只要有2Cacheable就查）：</li>
</ul>
<pre><code>package org.springframework.cache.interceptor

public abstract class CacheAspectSupport implements InitializingBean {

    private Object execute(Invoker invoker, CacheOperationContexts contexts) {
        ...

        Collection&lt;CacheOperationContext&gt; cacheOperationContexts =
                contexts.get(CacheableOperation.class);

        /* 原代码要求cacheOperationContexts为空且cachePutRequests也为空，即没有@CachePut时才从缓存拿
        if (cachePutRequests.isEmpty() &amp;&amp; cacheOperationContexts.isEmpty()) {
            result = findCachedResult(cacheOperationContexts);
        }*/
        //现在只查cacheOperationContexts，且相反，不为空才查缓存，也就是只要有@Cacheable就查缓存
        if (!cacheOperationContexts.isEmpty()) {
            result = findCachedResult(cacheOperationContexts);
        }

        ...
    }
}
</code></pre><ul>
<li>但是只改上面这个类只是做了第一步，后面还要做什么配置就不知道了。</li>
</ul>
<h4 id="自定义组合注解"><a href="#自定义组合注解" class="headerlink" title="自定义组合注解"></a>自定义组合注解</h4><ul>
<li>上面那个@Caching用在方法上会显得有点乱，此时我们可以把它定义成一个简洁的注解：</li>
</ul>
<pre><code>@Caching(
    put = {
            @CachePut(value = &quot;user&quot;, key = &quot;#user.id&quot;),
            @CachePut(value = &quot;user&quot;, key = &quot;#user.username&quot;),
            @CachePut(value = &quot;user&quot;, key = &quot;#user.email&quot;)
    }
)
@Target({ElementType.METHOD, ElementType.TYPE})
@Retention(RetentionPolicy.RUNTIME)
@Inherited
public @interface UserSaveCache {

}
</code></pre><h3 id="KeyGenerator"><a href="#KeyGenerator" class="headerlink" title="KeyGenerator"></a>KeyGenerator</h3><ul>
<li>KeyGenerator接口：如果在Cache注解上没有指定key的话，如@CachePut(value=”user”)，会调用KeyGenerator自动生成一个key。</li>
</ul>
<pre><code>public interface KeyGenerator {
    Object generate(Object target, Method method, Object... params);
}
</code></pre><ul>
<li>默认实现：</li>
<li>DefaultKeyGenerator：</li>
</ul>
<pre><code>@Override
public Object generate(Object target, Method method, Object... params) {
    //如果参数为空，就不知道key是个什么特定值了
    if (params.length == 0) {
        return SimpleKey.EMPTY;
    }
    //如果只有一个参数，就使用参数作为key，即传入User实例名为User参数
      的方法，key默认为“user”
    if (params.length == 1 &amp;&amp; params[0] != null) { 
        return params[0];
    }
    return new SimpleKey(params);
}
</code></pre><ul>
<li>SimpleKeyGenerator：Spring4之后默认使用的。</li>
<li>自定义KeyGenerator：然后用&lt;cache:annotation-driven key-generator=””/&gt;指定，或实现CachingConfiguration接口时重写方法设置进去。</li>
</ul>
<h3 id="使用xml代替缓存注解"><a href="#使用xml代替缓存注解" class="headerlink" title="使用xml代替缓存注解"></a>使用xml代替缓存注解</h3><ul>
<li>提供元素如下：</li>
</ul>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://zhuzhuzai.oss-cn-shenzhen.aliyuncs.com/%E6%8D%95%E8%8E%B7684.PNG" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<ul>
<li><a href="https://www.jianshu.com/p/e1c2067279bc" target="_blank" rel="noopener">具体参考文章</a></li>
</ul>
<h3 id="缓存模糊匹配"><a href="#缓存模糊匹配" class="headerlink" title="缓存模糊匹配"></a>缓存模糊匹配</h3><ul>
<li><p><a href="https://www.iteye.com/topic/1123633" target="_blank" rel="noopener">使用Spring 3.1注解缓存模糊匹配Evict</a></p>
</li>
<li><p><a href="https://jinnianshilongnian.iteye.com/blog/2001040/" target="_blank" rel="noopener">《Spring Cache抽象详解》</a></p>
</li>
<li>代码示例：ideaProjects/spring-cache</li>
</ul>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2019-05-03T09:08:17.994Z" itemprop="dateUpdated">2019-05-03 17:08:17</time>
</span><br>


        
        这里可以写作者留言，标签和 hexo 中所有变量及辅助函数等均可调用，示例：<a href="/2019/04/30/Spring Cache二之Cache注解/" target="_blank" rel="external">http://47.107.237.149/2019/04/30/Spring Cache二之Cache注解/</a>
        
    </div>
    
    <footer>
        <a href="http://47.107.237.149">
            <img src="/img/logo.jpg" alt="Haien">
            Haien
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            

            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://47.107.237.149/2019/04/30/Spring Cache二之Cache注解/&title=《Spring Cache二之Cache注解》 — never belief any book&pic=http://47.107.237.149/img/logo.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://47.107.237.149/2019/04/30/Spring Cache二之Cache注解/&title=《Spring Cache二之Cache注解》 — never belief any book&source=love youself,love life" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://47.107.237.149/2019/04/30/Spring Cache二之Cache注解/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Spring Cache二之Cache注解》 — never belief any book&url=http://47.107.237.149/2019/04/30/Spring Cache二之Cache注解/&via=http://47.107.237.149" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://47.107.237.149/2019/04/30/Spring Cache二之Cache注解/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2019/04/30/Spring Cache一之CacheManager的创建/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">Spring Cache一之CacheManager的创建</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2019/04/30/SpEL表达式/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">SpEL表达式</h4>
      </a>
    </div>
  
</nav>



    

















</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        谢谢大爷~
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/wechat.jpg" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/img/wechat.jpg" data-alipay="/img/alipay.jpg">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>博客内容遵循 <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></span>
        </p>
    </div>
    <div class="bottom">
        <p><span>Haien &copy; 2015 - 2019</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://47.107.237.149/2019/04/30/Spring Cache二之Cache注解/&title=《Spring Cache二之Cache注解》 — never belief any book&pic=http://47.107.237.149/img/logo.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://47.107.237.149/2019/04/30/Spring Cache二之Cache注解/&title=《Spring Cache二之Cache注解》 — never belief any book&source=love youself,love life" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://47.107.237.149/2019/04/30/Spring Cache二之Cache注解/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Spring Cache二之Cache注解》 — never belief any book&url=http://47.107.237.149/2019/04/30/Spring Cache二之Cache注解/&via=http://47.107.237.149" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://47.107.237.149/2019/04/30/Spring Cache二之Cache注解/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACvklEQVR42u3awW7jMAwE0Pz/T3eBngos4p2hxG0Oz6eicCI/FxDZoV6v+Pr6vn7+/PdvkjuTb3i3+vM9RxceHh7e6NHfXe/uSRZ+B8vXvfBZPDw8vDVeWwySjTvZyk9KTvJC8fDw8H6X91xO8s/mbXTbguPh4eF9Ji8pALOHe74fDw8P79N4SRhxHgHnv8lDkGtZCx4eHl6XkdYDsN/9eX2+h4eHhzeaqudFYvZeZ4148bR4eHh4C7ykbb219+ZrzVrk4j8GPDw8vGNeEqE+Y9oQNh+k5TFu9IfBw8PDO+Zdi0GDDfr82FZ9Dx4eHt4arx1BtZFB/vu8vY6+AQ8PD2+B1w69zh/ifJWTwAIPDw/vLi9phduGeBZSnD/DP7JqPDw8vEu8pBltm9ftSLeNPPDw8PBu8doR13nDPQsv8r8VHh4e3h4vb2rbcVR7Z8Kox294eHh4y7xksdmD5nFDPopLQl48PDy8Dd7Jdt+GEbPx1ew14eHh4e3x2ghgmA2P2vTnUhGVFjw8PLxlXvKB2XUS1x69aDw8PLwFXtLCnkQSedCQFIz8SBYeHh7eHi9phWdB7fkBrDbkLeZ7eHh4eJd4zxvx86O0W38SN9Q17d3oCw8PD2+N1/7zPwsXkpJwbSCHh4eHt8BrB1TJ8rMxf3uMoG7T8fDw8C7x2lF9vvysGOTte1So8PDw8P4LL29S22F/XjaSFaPmGw8PD2+Bd9Lg5kemZkcBXvEVhcJ4eHh4l3hf5TUb5J8cApgd6sLDw8Pb47WbbxLmJjHreTXL8Xh4eHgbvLwY5Bt9G8vOot7kpeDh4eHt8ZKFT1re81eWFK3hmQg8PDy8NV4ey7bb96wYRAfF8PDw8D6Al0eos63/VvONh4eHt83Lw4jiq+MDAbMiFJUZPDw8vAVeOwBrg4m2SLTDthqDh4eHN+f9AYrE2k81TxxPAAAAAElFTkSuQmCC" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>






<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = '死鬼去哪里了！';
            clearTimeout(titleTime);
        } else {
            document.title = '(つェ⊂)咦!又好了!';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>

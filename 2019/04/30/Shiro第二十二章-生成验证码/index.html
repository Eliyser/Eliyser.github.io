<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    
    <title>No title | never belief any book | love youself,love life</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#F98A8A">
    
    
    <meta name="keywords" content="">
    <meta name="description" content="简介 在实现登录功能时，大多数情况需要验证码支持，目的是防止机器人暴力破解密码。 目前比较简单的验证码通过一些OCR工具就可以解析出来，复杂的验证码（一般通过扭曲、加线条或噪点等干扰）能够防止OCR识别。更复杂的如填字、算数等验证码则需要人工识别。 目前比较可靠的是手机验证码，但是对于用户来说比普通验证码要麻烦得多。 验证码图片可以通过Java提供的图片API实现，也可以借助如JCaptcha（C">
<meta property="og:type" content="article">
<meta property="og:title" content="No title">
<meta property="og:url" content="http://47.107.237.149/2019/04/30/Shiro第二十二章-生成验证码/index.html">
<meta property="og:site_name" content="never belief any book">
<meta property="og:description" content="简介 在实现登录功能时，大多数情况需要验证码支持，目的是防止机器人暴力破解密码。 目前比较简单的验证码通过一些OCR工具就可以解析出来，复杂的验证码（一般通过扭曲、加线条或噪点等干扰）能够防止OCR识别。更复杂的如填字、算数等验证码则需要人工识别。 目前比较可靠的是手机验证码，但是对于用户来说比普通验证码要麻烦得多。 验证码图片可以通过Java提供的图片API实现，也可以借助如JCaptcha（C">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://zhuzhuzai.oss-cn-shenzhen.aliyuncs.com/6a835cfd-530c-36de-8e97-a4c3ba5d3db3.png">
<meta property="og:updated_time" content="2019-04-25T07:24:36.559Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="No title">
<meta name="twitter:description" content="简介 在实现登录功能时，大多数情况需要验证码支持，目的是防止机器人暴力破解密码。 目前比较简单的验证码通过一些OCR工具就可以解析出来，复杂的验证码（一般通过扭曲、加线条或噪点等干扰）能够防止OCR识别。更复杂的如填字、算数等验证码则需要人工识别。 目前比较可靠的是手机验证码，但是对于用户来说比普通验证码要麻烦得多。 验证码图片可以通过Java提供的图片API实现，也可以借助如JCaptcha（C">
<meta name="twitter:image" content="http://zhuzhuzai.oss-cn-shenzhen.aliyuncs.com/6a835cfd-530c-36de-8e97-a4c3ba5d3db3.png">
    
        <link rel="alternate" type="application/atom+xml" title="never belief any book" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/logo.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Haien</h5>
          <a href="mailto:1410343862@qq.com" title="1410343862@qq.com" class="mail">1410343862@qq.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/Eliyser" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                Weibo
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/custom"  >
                <i class="icon icon-lg icon-link"></i>
                测试
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis"></div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title"></h1>
        <h5 class="subtitle">
            
                <time datetime="2019-04-30T08:29:22.921Z" itemprop="datePublished" class="page-time">
  2019-04-30
</time>


            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#简介"><span class="post-toc-number">1.</span> <span class="post-toc-text">简介</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#示例"><span class="post-toc-number">2.</span> <span class="post-toc-text">示例</span></a></li></ol>
        </nav>
    </aside>


<article id="post-Shiro第二十二章-生成验证码"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title"></h1>
        <div class="post-meta">
            <time class="post-time" title="2019-04-30 16:29:22" datetime="2019-04-30T08:29:22.921Z"  itemprop="datePublished">2019-04-30</time>

            


            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><ul>
<li>在实现登录功能时，大多数情况需要验证码支持，目的是防止机器人暴力破解密码。</li>
<li>目前比较简单的验证码通过一些OCR工具就可以解析出来，复杂的验证码（一般通过扭曲、加线条或噪点等干扰）能够防止OCR识别。更复杂的如填字、算数等验证码则需要人工识别。</li>
<li>目前比较可靠的是手机验证码，但是对于用户来说比普通验证码要麻烦得多。</li>
<li>验证码图片可以通过Java提供的图片API实现，也可以借助如JCaptcha（Completely Automated Public Turing Test To Tell Computers adn Humans Apart）这种开源Java类库生成，它提供了常见的扭曲、加线条和噪点等干扰的支持。</li>
</ul>
<h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><ul>
<li><p>基于第十六章，是一个权限管理系统，但本例中后台管理不是主要内容，现新增一个jcaptcha包，放置所有和验证码有关的类，用于实现用户登录时获取验证码和提交表单后校验验证码的功能。</p>
</li>
<li><p>依赖：</p>
<pre><code>&lt;!--jcaptcha核心--&gt;
&lt;dependency&gt;  
    &lt;groupId&gt;com.octo.captcha&lt;/groupId&gt;  
    &lt;artifactId&gt;jcaptcha&lt;/artifactId&gt;  
    &lt;version&gt;2.0-alpha-1&lt;/version&gt;  
&lt;/dependency&gt;  
&lt;!--支持与servlet集成--&gt;
&lt;dependency&gt;  
    &lt;groupId&gt;com.octo.captcha&lt;/groupId&gt;  
    &lt;artifactId&gt;jcaptcha-integration-simple-servlet&lt;/artifactId&gt;  
    &lt;version&gt;2.0-alpha-1&lt;/version&gt;  
    &lt;exclusions&gt;  
        &lt;exclusion&gt;  
            &lt;artifactId&gt;servlet-api&lt;/artifactId&gt;  
            &lt;groupId&gt;javax.servlet&lt;/groupId&gt;  
        &lt;/exclusion&gt;  
    &lt;/exclusions&gt;  
&lt;/dependency&gt;
</code></pre></li>
<li><p>实际能用的依赖如下：</p>
<pre><code>  &lt;!--jcaptcha验证码工具--&gt;
  &lt;dependency&gt;&lt;!--jcaptcha核心--&gt;
&lt;groupId&gt;com.octo.captcha&lt;/groupId&gt;
&lt;artifactId&gt;jcaptcha&lt;/artifactId&gt;
&lt;version&gt;1.0&lt;/version&gt;
&lt;exclusions&gt; &lt;!--不排除此包，tomcat启动出错--&gt;
  &lt;exclusion&gt;
    &lt;artifactId&gt;servlet-api&lt;/artifactId&gt;
    &lt;groupId&gt;javax.servlet&lt;/groupId&gt;
  &lt;/exclusion&gt;
&lt;/exclusions&gt;
</code></pre><p>  </p>
  <dependency><br>    <groupid>com.octo.captcha</groupid><br>    <artifactid>jcaptcha-api</artifactid><br>    <version>1.0</version><br>  </dependency>
</li>
<li><p>GMailEngine：验证码图片生成引擎，继承自ListImageCaptchaEngine，只需要简单设置以下图片和字体大小等，即可仿照jcaptcha2.0生成类似GMail验证码的样式。</p>
</li>
</ul>
<pre><code>public class GMailEngine extends ListImageCaptchaEngine {

    @Override
    protected void buildInitialFactories() {

        // 图片和字体大小设置
        int minWordLength = 4;
        int maxWordLength = 5;
        int fontSize = 20;
        int imageWidth = 100;
        int imageHeight = 36;

        WordGenerator dictionnaryWords = new ComposeDictionaryWordGenerator(
                new FileDictionary(&quot;toddlist&quot;));

        // word2image components
        TextPaster randomPaster = new DecoratedRandomTextPaster(minWordLength,
                maxWordLength, new RandomListColorGenerator(new Color[]{
                new Color(23, 170, 27), new Color(220, 34, 11),
                new Color(23, 67, 172)}), new TextDecorator[]{});
        BackgroundGenerator background = new UniColorBackgroundGenerator(
                imageWidth, imageHeight, Color.white);
        FontGenerator font = new RandomFontGenerator(fontSize, fontSize,
                new Font[]{new Font(&quot;nyala&quot;, Font.BOLD, fontSize),
                        new Font(&quot;Bell MT&quot;, Font.PLAIN, fontSize),
                        new Font(&quot;Credit valley&quot;, Font.BOLD, fontSize)});

        ImageDeformation postDef = new ImageDeformationByFilters(
                new ImageFilter[]{});
        ImageDeformation backDef = new ImageDeformationByFilters(
                new ImageFilter[]{});
        ImageDeformation textDef = new ImageDeformationByFilters(
                new ImageFilter[]{});

        WordToImage word2image = new DeformedComposedWordToImage(font,
                background, randomPaster, backDef, textDef, postDef);

        addFactory(new GimpyFactory(dictionnaryWords, word2image));
    }

}
</code></pre><ul>
<li>MyManageableImageCaptchaService：使用GMailEngine生成验证码图片、比对验证码（每验证一次无论成功与否都会删除该验证码）。</li>
</ul>
<pre><code>public class MyManageableImageCaptchaService 
    extends DefaultManageableImageCaptchaService {

    /**
     * @Author haien
     * @Description 构造器，生成验证码图片
     * @Date 16:08 2019/4/19
     * @Param [captchaStore, captchaEngine, minGuarantedStorageDelayInSeconds,
        maxCaptchaStoreSize, captchaStoreLoadBeforeGarbageCollection]
     **/
    public MyManageableImageCaptchaService(CaptchaStore captchaStore,
                                           CaptchaEngine captchaEngine,
                                           int minGuarantedStorageDelayInSeconds,
                                           int maxCaptchaStoreSize,
                                           int captchaStoreLoadBeforeGarbageCollection)
                                           {
        super(captchaStore,captchaEngine,minGuarantedStorageDelayInSeconds,
                maxCaptchaStoreSize, captchaStoreLoadBeforeGarbageCollection);
    }

    /**
     * @Author haien
     * @Description 根据会话id获取当前会话的验证码，与用户输入的比对
     * @Date 2019/4/11
     * @Param [id会话id, userCaptchaResponse用户输入的验证码]
     * @return boolean
     **/
    public boolean validate(String id,String userCaptchaResponse){
        //验证但不删除
        return store.getCaptcha(id).validateResponse(userCaptchaResponse); 
    }
}
</code></pre><ul>
<li>JCaptcha：jcaptcha工具类，利用MyManageableImageCaptchaService生成和验证验证码。</li>
</ul>
<pre><code>public class JCaptcha {
    public static final MyManageableImageCaptchaService captchaService=
            new MyManageableImageCaptchaService(new FastHashMapCaptchaStore(),
                    new GMailEngine(),180,
                    100000,75000);

    /**
     * @Author haien
     * @Description 比对当前请求输入的验证码是否正确，
                    并从CaptchaService中移除已使用过的验证码
     * @Date 2019/4/11
     * @Param [request, userCaptchaResponse用户输入的验证码]
     * @return boolean
     **/
    public static boolean validateResponse(HttpServletRequest request,
            String userCaptchaResponse){
        //为true应该是没有session则新建
        if(request.getSession(false)==null) return false;

        boolean validated=false;
        try {
            //获取会话id
            String id = request.getSession().getId();
            //将用户输入的验证码与库存比对，并移除验证码与id（无论正确与否）
            validated = captchaService.validateResponseForID(id, userCaptchaResponse)
                    .booleanValue();
        }catch (CaptchaServiceException e){
            e.printStackTrace();
        }

        return validated;
    }

    /**
     * @Author haien
     * @Description 比对，但不移除验证码，适用于Ajax异步验证，
                    此时不是真的验证，还不能删除验证码
     * @Date 2019/4/11
     * @Param [request, userCaptchaResponse]
     * @return boolean
     **/
    public static boolean validate(HttpServletRequest request,
            String userCaptchaResponse){
        if (request.getSession(false)==null) return false;

        boolean validated=false;
        try {
            String id=request.getSession().getId();
            validated=captchaService.validate(id,userCaptchaResponse);
        }catch (CaptchaServiceException e){
            e.printStackTrace();
        }

        return validated;
    }
}
</code></pre><ul>
<li>JCaptchaFilter：拦截前端的验证码请求，调用JCaptcha工具类生成并向前端写验证码图片。</li>
</ul>
<pre><code>//保证只执行一次，注：继承的是spring的Filter
public class JCaptchaFilter extends OncePerRequestFilter { 

    @Override
    protected void doFilterInternal(HttpServletRequest request, 
            HttpServletResponse response,FilterChain chain) 
            throws ServletException, IOException {
        //响应内容不缓存
        response.setDateHeader(&quot;Expires&quot;,0L);
        response.setHeader(&quot;Cache-Control&quot;,&quot;no-store,no-cache,must-revalidate&quot;);
        response.addHeader(&quot;Cache-Control&quot;,&quot;post-check=0,pre-check=0&quot;);
        response.setHeader(&quot;Pragma&quot;,&quot;no-cache&quot;);
        response.setContentType(&quot;image/jpeg&quot;);

        String id=request.getRequestedSessionId();
        //captchaService使用当前会话的id作为key获取相应的验证码图片
        BufferedImage bi=JCaptcha.captchaService.getImageChallengeForID(id);
        ServletOutputStream out=response.getOutputStream();
        ImageIO.write(bi,&quot;jpg&quot;,out);
        try {
            out.flush();
        }finally {
            out.close();
        }
    }
}
</code></pre><ul>
<li><p>login.jsp: 前端登录页面请求验证码。</p>
<pre><code>//若支持验证码
&lt;c:if test=&quot;${jcaptchaEbabled}&quot;&gt;
    验证码：
    &lt;input type=&quot;text&quot; name=&quot;jcaptchaCode&quot;&gt;
    &lt;img class=&quot;jcaptcha-btn jcaptcha-img&quot; 
        src=&quot;${pageContext.request.contextPath}/jcaptcha.jpg&quot; 
        title=&quot;点击更换验证码&quot;&gt;
    &lt;a class=&quot;jcaptcha-btn&quot; href=&quot;javascript:;&quot;&gt;换一张&lt;/a&gt;&lt;br/&gt;
&lt;/c:if&gt;

&lt;script&gt;
    $(function() {
        $(&quot;.jcaptcha-btn&quot;).click(function() {
            $(&quot;.jcaptcha-img&quot;).attr(&quot;src&quot;,
            &apos;${pageContext.request.contextPath}/jcaptcha.jpg?&apos; //按钮对应url，
                                                               //触发JCaptchaFilter
                +new Date().getTime());
        });
    });
&lt;/script&gt;
</code></pre></li>
<li><p>web.xml：分配验证码请求给JCaptchaFilter拦截。</p>
<pre><code>&lt;!--验证码过滤器需要放到ShiroFilter之后，因为Shiro将包装HttpSession；
否则可能造成两次的session id不同--&gt;
  &lt;filter&gt;
    &lt;filter-name&gt;JCaptchaFilter&lt;/filter-name&gt;
    &lt;filter-class&gt;com.haien.chapter22.jcaptcha.JCaptchaFilter&lt;/filter-class&gt;
    &lt;async-supported&gt;true&lt;/async-supported&gt;
  &lt;/filter&gt;
  &lt;filter-mapping&gt;
    &lt;filter-name&gt;JCaptchaFilter&lt;/filter-name&gt;
    &lt;!--前台登录页面点击“获取验证码”，其url为此，则执行该过滤链，
    生成验证码图片并写到客户端--&gt;
    &lt;url-pattern&gt;/jcaptcha.jpg&lt;/url-pattern&gt;
  &lt;/filter-mapping&gt;
</code></pre></li>
<li><p>JCaptchaValidateFilter：拦截验证码验证请求的拦截器，主要是调用JCaptcha工具类进行验证。</p>
</li>
</ul>
<pre><code>public class JCaptchaValidateFilter extends AccessControlFilter {
    //是否开启验证码支持
    private boolean jcaptchaEnabled=true;
    //前台提交的验证码参数名
    private String jcaptchaParam=&quot;jcaptchaCode&quot;;
    //验证失败后存储到的属性名
    private String failureKeyAttribute=&quot;shiroLoginFailure&quot;;

    public void setJcaptchaEnabled(boolean jcaptchaEnabled) {
        this.jcaptchaEnabled = jcaptchaEnabled;
    }
    public void setJcaptchaParam(String jcaptchaParam) {
        this.jcaptchaParam = jcaptchaParam;
    }
    public void setFailureKeyAttribute(String failureKeyAttribute) {
        this.failureKeyAttribute = failureKeyAttribute;
    }

    /**
     * @Author haien
     * @Description 验证验证码
     * @Date 2019/4/19
     * @Param [request, response, mappedValue]
     * @return boolean
     **/
    @Override
    protected boolean isAccessAllowed(ServletRequest request, ServletResponse response,
                                      Object mappedValue) throws Exception {

        //1. 设置验证码是否开启属性，页面据此决定是否显示验证码
        request.setAttribute(&quot;jcaptchaEnabled&quot;,jcaptchaEnabled);
        //将HttpServlet的request转为HttpServlet类型
        HttpServletRequest httpServletRequest=WebUtils.toHttp(request);

        //2. 判断验证码是否禁用|不是由表单提交的
        if(jcaptchaEnabled==false || 
            ! &quot;post&quot;.equalsIgnoreCase(httpServletRequest.getMethod())){
            //则不用验证，直接结束
            return true;
        }

        //3. 验证 验证码,正确则返回true，否则false
        return JCaptcha.validateResponse(httpServletRequest,
                httpServletRequest.getParameter(jcaptchaParam));
    }

    /**
     * @Author haien
     * @Description 验证失败处理
     * @Date 2019/4/19
     * @Param [request, response]
     * @return boolean
     **/
    @Override
    protected boolean onAccessDenied(ServletRequest request, ServletResponse response)
            throws Exception {
        //若验证失败，则存储failureKeyAttribute属性；可通过getFailureKeyAttribute()获取
        request.setAttribute(failureKeyAttribute,&quot;jCaptcha.error&quot;);
        return true;
    }
}
</code></pre><ul>
<li>MyFormAuthenticationFilter：继承FormAuthenticationFilter，自定义身份验证拦截器，主要是增加验证码错误情况下不验证身份的条件。</li>
</ul>
<pre><code>public class MyFormAuthenticationFilter extends FormAuthenticationFilter {
    @Override
    protected boolean isAccessAllowed(ServletRequest request, ServletResponse response,
            Object mappedValue) {

        //若为登录请求，无论登录与否，直接进入onAccessDenied
        if(isLoginRequest(request,response)) return false;

        return super.isAccessAllowed(request, response, mappedValue);
    }

    @Override
    protected boolean onAccessDenied(ServletRequest request, ServletResponse response,
                                     Object mappedValue) throws Exception {
        //验证码错误则直接返回，不用身份验证了
        if(request.getAttribute(getFailureKeyAttribute()) != null) return true;

        return super.onAccessDenied(request,response,mappedValue);
    }
}
</code></pre><ul>
<li><p>spring-config-shiro.xml:</p>
<pre><code>&lt;!-- 基于Form表单的身份验证过滤器 --&gt;
&lt;bean id=&quot;authcFilter&quot;
      class=&quot;com.haien.chapter22.jcaptcha.MyFormAuthenticationFilter&quot;&gt;
    &lt;property name=&quot;usernameParam&quot; value=&quot;username&quot;/&gt;
    &lt;property name=&quot;passwordParam&quot; value=&quot;password&quot;/&gt;
    &lt;property name=&quot;rememberMeParam&quot; value=&quot;rememberMe&quot;/&gt;
    &lt;property name=&quot;failureKeyAttribute&quot; value=&quot;shiroLoginFailure&quot;/&gt;&lt;!--值同JCaptchaValidateFilter--&gt;
&lt;/bean&gt;
&lt;bean id=&quot;JCaptchaValidateFilter&quot; class=&quot;com.haien.chapter22.jcaptcha.JCaptchaValidateFilter&quot;&gt;
    &lt;property name=&quot;jcaptchaEnabled&quot; value=&quot;true&quot;/&gt;
    &lt;property name=&quot;jcaptchaParam&quot; value=&quot;jcaptchaCode&quot;/&gt;
    &lt;property name=&quot;failureKeyAttribute&quot; value=&quot;shiroLoginFailure&quot;/&gt;
&lt;/bean&gt;
&lt;bean id=&quot;sysUserFilter&quot;
      class=&quot;com.haien.chapter22.web.shiro.filter.SysUserFilter&quot;/&gt;

&lt;!-- Shiro的Web过滤器 --&gt;
&lt;bean id=&quot;shiroFilter&quot; class=&quot;org.apache.shiro.spring.web.ShiroFilterFactoryBean&quot;&gt;
    &lt;property name=&quot;securityManager&quot; ref=&quot;securityManager&quot;/&gt;
    &lt;property name=&quot;loginUrl&quot; value=&quot;/login&quot;/&gt;
    &lt;property name=&quot;filters&quot;&gt;
        &lt;util:map&gt;
            &lt;entry key=&quot;authc&quot; value-ref=&quot;authcFilter&quot;/&gt;
            &lt;entry key=&quot;sysUser&quot; value-ref=&quot;sysUserFilter&quot;/&gt;
            &lt;entry key=&quot;JCaptchaValidate&quot; value-ref=&quot;JCaptchaValidateFilter&quot;/&gt;
        &lt;/util:map&gt;
    &lt;/property&gt;
    &lt;property name=&quot;filterChainDefinitions&quot;&gt;
        &lt;!--其实第一行可以不配置，因为spring-mvc.xml已经映射了静态资源？--&gt;
        &lt;value&gt;
            /static/**=anon
            /jcaptcha*=anon
            /login = JCaptchaValidate,authc
            /logout = logout
            /authenticated = authc
            /** = user,sysUser
        &lt;/value&gt;
    &lt;/property&gt;
&lt;/bean&gt;
</code></pre></li>
<li><p>测试：访问<a href="http://localhost:8080/chapter22，将重定向到登录页面，显示验证码图片，点击可换一张。输入验证码，错误则返回登录页面，并提示验证码错误。" target="_blank" rel="noopener">http://localhost:8080/chapter22，将重定向到登录页面，显示验证码图片，点击可换一张。输入验证码，错误则返回登录页面，并提示验证码错误。</a></p>
</li>
</ul>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://zhuzhuzai.oss-cn-shenzhen.aliyuncs.com/6a835cfd-530c-36de-8e97-a4c3ba5d3db3.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<ul>
<li>代码示例：ideaProjects/shiro-chapter22</li>
<li><a href="https://jinnianshilongnian.iteye.com/blog/2046041" target="_blank" rel="noopener">《跟我学Shiro》第二十二章</a></li>
</ul>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2019-04-25T07:24:36.559Z" itemprop="dateUpdated">2019-04-25 15:24:36</time>
</span><br>


        
        这里可以写作者留言，标签和 hexo 中所有变量及辅助函数等均可调用，示例：<a href="/2019/04/30/Shiro第二十二章-生成验证码/" target="_blank" rel="external">http://47.107.237.149/2019/04/30/Shiro第二十二章-生成验证码/</a>
        
    </div>
    
    <footer>
        <a href="http://47.107.237.149">
            <img src="/img/logo.jpg" alt="Haien">
            Haien
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            

            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://47.107.237.149/2019/04/30/Shiro第二十二章-生成验证码/&title=never belief any book&pic=http://47.107.237.149/img/logo.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://47.107.237.149/2019/04/30/Shiro第二十二章-生成验证码/&title=never belief any book&source=love youself,love life" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://47.107.237.149/2019/04/30/Shiro第二十二章-生成验证码/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=never belief any book&url=http://47.107.237.149/2019/04/30/Shiro第二十二章-生成验证码/&via=http://47.107.237.149" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://47.107.237.149/2019/04/30/Shiro第二十二章-生成验证码/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2019/04/30/Shiro第二十三章-多项目集中权限管理及分布式会话/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">[no title]</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2019/04/30/Shiro第八章一-拦截器机制/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">[no title]</h4>
      </a>
    </div>
  
</nav>



    

















</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        谢谢大爷~
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/wechat.jpg" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/img/wechat.jpg" data-alipay="/img/alipay.jpg">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>博客内容遵循 <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></span>
        </p>
    </div>
    <div class="bottom">
        <p><span>Haien &copy; 2015 - 2019</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://47.107.237.149/2019/04/30/Shiro第二十二章-生成验证码/&title=《No title》 — never belief any book&pic=http://47.107.237.149/img/logo.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://47.107.237.149/2019/04/30/Shiro第二十二章-生成验证码/&title=《No title》 — never belief any book&source=love youself,love life" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://47.107.237.149/2019/04/30/Shiro第二十二章-生成验证码/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《No title》 — never belief any book&url=http://47.107.237.149/2019/04/30/Shiro第二十二章-生成验证码/&via=http://47.107.237.149" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://47.107.237.149/2019/04/30/Shiro第二十二章-生成验证码/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACvElEQVR42u3aQW7jMBAEwPz/01lgb4tYcveQlLNA6WQotMxiAA3RnK+v+Pr+e/38fHXn51+vvpV/937k0oWHh4c3mvrVdT8meU4+6Xwhkjnj4eHhneYlxSC5k7+lk+fcL8T9nPHw8PB+A2+2HO1z8sXFw8PD+1947QY6jyfWixAeHh7ek7wkjFjhtdFGHltsy1rw8PDwYt7KAdinPj90voeHh4dXnqrngUJ7J2lBaIvBi9ni4eHhHeDNDpmiCGC0LW5ji2gkHh4e3lbersKQvNZXNuh5k8E/n/Hw8PCO8ZKXeP6KnzUf5DFusRHHw8PDO8bbRcqLwUoAUSwfHh4e3jHeLFZoX+L58rUL8SZlwcPDwzvAy4+aZjnxLLDIN/qXY/Dw8PCO8ZKQtAW0MUc+pmhHwMPDwzvMa7fF7eFWGze0QcmLOeDh4eEd491PaHZktVJIcsybOeDh4eE9yMsfcX+1zQF5XBsVJzw8PLxHeC3yPiyYbabbCPjy34OHh4d3gJc3Nt0/bhbmtnfyBcXDw8N7htce58+CiXZR2pD3sjDg4eHhbeK1ZWBXrNA2b+WHakutA3h4eHhxL9P6drn97spBV1u08PDw8PbyZnvwvGDkCzcrNnh4eHjP89rDqtlrOi8AR34LDw8P7xFeMon1OCOJJ/ISVSQueHh4eAu8vC0guTPbUq9v6KOeMjw8PLwDvHxabUixsiFeCUfw8PDwTvBWks88Dp4ViXZRNge7eHh4eBdjvsvrmeOrWbl6AcbDw8M7wFspFbPGqV1Ls4GEh4eHt8BbCU/zqCLfuLeh8Jsn4+Hh4R3jJRFDEkDMIomVHOXNGDw8PLyP8mbhRR4Nt8WgOOXDw8PD+yhv9tccMJvP5X08PDy8Y7xZY1MSwrYNUivf2pa14OHh4U16meq2qtlPtox2JB4eHt5W3h8pTLGGB9VXDwAAAABJRU5ErkJggg==" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>






<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = '死鬼去哪里了！';
            clearTimeout(titleTime);
        } else {
            document.title = '(つェ⊂)咦!又好了!';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
